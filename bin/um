#! /usr/bin/env ruby

$libexec_path = File.expand_path("../libexec", File.dirname(__FILE__))
program_name = File.basename($PROGRAM_NAME)

def run(file_name, should_shift: true)
  ARGV.shift if should_shift
  exec(%{ruby "#{$libexec_path}/#{file_name}.rb" "#{ARGV.join(" ")}"})
end

aliases = {
  "e" => "environment",
  "l" => "list",
  "r" => "read",
  "s" => "set",
  "t" => "topic"
}

command = ARGV.first
command = aliases[command] || command

if command.to_s.empty?
    $stderr.puts "usage: #{program_name} (<page name> | <sub-command> [args...])"
    exit 1
end

case command
when "environment"
  run "um-environment"
when "list"
  run "um-list"
when "read"
  run "um-read"
when "set"
  run "um-set"
when "topic"
  run "um-topic"
else
  run "um-read", should_shift: false
end
